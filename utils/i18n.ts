
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

const LANGUAGE_KEY = '@nutrion_language';

// Complete translation resources for all languages
const resources = {
  en: {
    translation: {
      // Common
      cancel: 'Cancel',
      save: 'Save',
      delete: 'Delete',
      edit: 'Edit',
      add: 'Add',
      search: 'Search',
      loading: 'Loading...',
      error: 'Error',
      success: 'Success',
      confirm: 'Confirm',
      ok: 'OK',
      next: 'Next',
      skip: 'Skip',
      continue: 'Continue',
      getStarted: 'Get Started',
      
      // Tabs
      pantry: 'Pantry',
      planner: 'Planner',
      shopping: 'Shopping',
      profile: 'Profile',
      
      // Onboarding
      'onboarding.welcome': 'Welcome to Nutrion',
      'onboarding.welcomeDesc': 'Your smart kitchen companion that helps you manage food, reduce waste, and discover amazing recipes.',
      'onboarding.pantryTitle': 'Smart Pantry Tracking',
      'onboarding.pantryDesc': 'Add items manually or search our database. Keep track of everything in your kitchen with ease.',
      'onboarding.aiTitle': 'AI Recipe Suggestions',
      'onboarding.aiDesc': 'Get personalized meal ideas based on what you have. Cook delicious meals without extra shopping.',
      'onboarding.wasteTitle': 'Never Waste Food',
      'onboarding.wasteDesc': 'Smart expiration alerts keep you informed. Save money and help the planet by reducing food waste.',
      
      // Auth
      'auth.signIn': 'Sign In',
      'auth.signUp': 'Sign Up',
      'auth.signOut': 'Sign Out',
      'auth.notLoggedIn': 'Not Logged In',
      'auth.email': 'Email',
      'auth.password': 'Password',
      'auth.fillAllFields': 'Please fill all fields',
      'auth.invalidEmail': 'Invalid email address',
      'auth.passwordsDoNotMatch': 'Passwords do not match',
      'auth.passwordTooShort': 'Password must be at least 6 characters',
      'auth.signInFailed': 'Sign in failed',
      'auth.signUpFailed': 'Sign up failed',
      'auth.welcomeBack': 'Welcome back!',
      'auth.verifyEmail': 'Verify Your Email',
      'auth.verifyEmailMessage': 'Please check your email and click the verification link to complete your registration.',
      'auth.accountCreated': 'Account created successfully!',
      'auth.unexpectedError': 'An unexpected error occurred',
      'auth.forgotPassword': 'Forgot Password?',
      'auth.skipForNow': 'Skip for now',
      
      // Subscription
      'subscription.title': 'Unlock Premium Features',
      'subscription.subtitle': 'Get full access to all features with our affordable subscription',
      'subscription.month': 'month',
      'subscription.freeTrial': '30 Days Free Trial',
      'subscription.whatYouGet': 'What You Get',
      'subscription.feature1Title': 'Smart Pantry Management',
      'subscription.feature1Desc': 'Track all your food items with expiration alerts and smart categorization',
      'subscription.feature2Title': 'AI Recipe Suggestions',
      'subscription.feature2Desc': 'Get personalized meal ideas based on ingredients you already have',
      'subscription.feature3Title': 'Shopping List Sync',
      'subscription.feature3Desc': 'Automatically generate shopping lists and sync across devices',
      'subscription.feature4Title': 'Reduce Food Waste',
      'subscription.feature4Desc': 'Save money and help the environment with smart expiration tracking',
      'subscription.trialInfo': 'Try free for 30 days, then just $1.99/month. Cancel anytime.',
      'subscription.continue': 'Start Free Trial',
      'subscription.disclaimer': 'No payment required during trial period',
      
      // Pantry
      'pantry.title': 'My Pantry',
      'pantry.addFirst': 'Add your first item',
      'pantry.search': 'Search pantry...',
      'pantry.addItem': 'Add Item',
      'pantry.foodSearch': 'Food Search',
      'pantry.itemName': 'Item Name',
      'pantry.category': 'Category',
      'pantry.quantity': 'Quantity',
      'pantry.unit': 'Unit',
      'pantry.expirationDate': 'Expiration Date',
      'pantry.notes': 'Notes',
      'pantry.addToPantry': 'Add to Pantry',
      'pantry.itemAdded': 'Item added to pantry!',
      'pantry.itemDeleted': 'Item deleted',
      'pantry.deleteConfirm': 'Are you sure you want to delete this item?',
      'pantry.expiresIn': 'Expires in {{days}} days',
      'pantry.expired': 'Expired',
      'pantry.fresh': 'Fresh',
      'pantry.emptyTitle': 'Your pantry is empty',
      'pantry.emptyDescription': 'Start by adding items to track your food inventory',
      'pantry.editItem': 'Edit Item',
      'pantry.updateItem': 'Update Item',
      'pantry.itemUpdated': 'Item updated successfully!',
      
      // Planner
      'planner.title': 'Meal Planner',
      'planner.myRecipes': 'My Recipes',
      'planner.aiSuggestions': 'AI Suggestions',
      'planner.basedOnPantry': 'Based on your pantry items',
      'planner.noRecipes': 'No recipes yet',
      'planner.addRecipeHint': 'Add recipes to start planning meals',
      'planner.ingredientsAvailable': '{{count}} ingredients available',
      'planner.loadingRecipes': 'Loading AI recipe suggestions...',
      'planner.pullToRefresh': 'Pull down to refresh',
      'planner.dragToLoadAI': 'Drag down to load AI suggestions',
      
      // Shopping
      'shopping.title': 'Shopping List',
      'shopping.addNewItem': 'Add New Item',
      'shopping.itemsCompleted': '{{count}} items completed',
      'shopping.clearCompleted': 'Clear Completed',
      'shopping.noShoppingItems': 'Your shopping list is empty',
      'shopping.addItemsHint': 'Add items you need to buy',
      'shopping.item': 'item',
      'shopping.items': 'items',
      'shopping.toBuy': 'to buy',
      'shopping.clear': 'Clear',
      'shopping.itemName': 'Item name',
      'shopping.quantity': 'Quantity',
      'shopping.addItem': 'Add Item',
      'shopping.qty': 'Qty',
      'shopping.emptyTitle': 'Shopping list is empty',
      'shopping.emptyDescription': 'Add items you need to buy from the store',
      'shopping.toBuySection': 'To Buy',
      'shopping.completedSection': 'Completed',
      'shopping.loadError': 'Failed to load shopping items',
      'shopping.enterItemName': 'Please enter an item name',
      'shopping.enterValidQuantity': 'Please enter a valid quantity',
      'shopping.addItemError': 'Failed to add item',
      'shopping.updateItemError': 'Failed to update item',
      'shopping.deleteItemError': 'Failed to delete item',
      'shopping.clearCompletedConfirm': 'Remove all checked items from the list?',
      'shopping.clearCompletedError': 'Failed to clear completed items',
      
      // Profile
      'profile.title': 'Profile',
      'profile.statistics': 'Statistics',
      'profile.totalItems': 'Total Items',
      'profile.expiringSoon': 'Expiring Soon',
      'profile.expired': 'Expired',
      'profile.security': 'Security',
      'profile.settings': 'Settings',
      'profile.language': 'Language',
      'profile.languageDesc': 'Change app language',
      'profile.notifications': 'Notifications',
      'profile.notificationsDesc': 'Manage notification preferences',
      'profile.about': 'About',
      'profile.aboutDesc': 'App information and support',
      'profile.tutorial': 'Tutorial',
      'profile.tutorialDesc': 'View app tutorial again',
      'profile.signOut': 'Sign Out',
      'profile.signOutConfirm': 'Are you sure you want to sign out?',
      'profile.signedOut': 'Signed out successfully',
      'profile.signOutError': 'Failed to sign out',
      'profile.pleaseSignIn': 'Please sign in to use this feature',
      'profile.twoFactor': 'Two-Factor Authentication',
      'profile.twoFactorDesc': 'Add an extra layer of security',
      'profile.twoFactorEnabled': 'Enabled',
      'profile.twoFaDisabled': 'Two-factor authentication disabled',
      'profile.twoFaDisableError': 'Failed to disable two-factor authentication',
      'profile.disableTwoFa': 'Disable 2FA',
      'profile.disableTwoFaConfirm': 'Are you sure you want to disable two-factor authentication?',
      'profile.disable': 'Disable',
      
      // Notifications
      'notifications.title': 'Notification Settings',
      'notifications.enabled': 'Enable Notifications',
      'notifications.expirationAlerts': 'Expiration Alerts',
      'notifications.expirationAlertsDesc': 'Get notified when items are about to expire',
      'notifications.daysBeforeExpiry': 'Days Before Expiry',
      'notifications.dailyReminder': 'Daily Reminder',
      'notifications.dailyReminderDesc': 'Daily summary of expiring items',
      'notifications.shoppingListReminders': 'Shopping List Reminders',
      'notifications.shoppingListRemindersDesc': 'Reminders for shopping list items',
      'notifications.recipesSuggestions': 'Recipe Suggestions',
      'notifications.recipesSuggestionsDesc': 'Get notified about new recipe ideas',
      'notifications.permissionRequired': 'Permission Required',
      'notifications.permissionMessage': 'Please enable notifications in your device settings to receive alerts.',
      'notifications.openSettings': 'Open Settings',
      
      // About
      'about.title': 'About Nutrion',
      'about.version': 'Version',
      'about.description': 'Nutrion helps you manage your pantry, track food expiration dates, and automatically plan balanced meals based on what\'s already available at home.',
      'about.features': 'Features',
      'about.website': 'Website',
      'about.privacy': 'Privacy Policy',
      'about.terms': 'Terms of Service',
      'about.support': 'Support',
      'about.rateApp': 'Rate App',
      'about.madeWith': 'Made with ❤️ by the Nutrion Team',
      'about.copyright': '© 2025 Nutrion. All rights reserved.',
      
      // Food Search
      searchForFoods: 'Search for Foods',
      searchPlaceholder: 'Search for food items...',
      searchHint: 'Type at least 2 characters to search',
      resultsFor: '{{count}} results for "{{query}}"',
      noResults: 'No results found',
      tryDifferent: 'Try a different search term',
      
      // Categories
      dairy: 'Dairy',
      meat: 'Meat',
      fruits: 'Fruits',
      vegetables: 'Vegetables',
      grains: 'Grains',
      beverages: 'Beverages',
      snacks: 'Snacks',
      condiments: 'Condiments',
      frozen: 'Frozen',
      other: 'Other',
      
      // Units
      pcs: 'pcs',
      kg: 'kg',
      g: 'g',
      lb: 'lb',
      oz: 'oz',
      l: 'L',
      ml: 'mL',
      cup: 'cup',
      tbsp: 'tbsp',
      tsp: 'tsp',
    },
  },
  es: {
    translation: {
      // Common
      cancel: 'Cancelar',
      save: 'Guardar',
      delete: 'Eliminar',
      edit: 'Editar',
      add: 'Agregar',
      search: 'Buscar',
      loading: 'Cargando...',
      error: 'Error',
      success: 'Éxito',
      confirm: 'Confirmar',
      ok: 'OK',
      next: 'Siguiente',
      skip: 'Saltar',
      continue: 'Continuar',
      getStarted: 'Comenzar',
      
      // Tabs
      pantry: 'Despensa',
      planner: 'Planificador',
      shopping: 'Compras',
      profile: 'Perfil',
      
      // Onboarding
      'onboarding.welcome': 'Bienvenido a Nutrion',
      'onboarding.welcomeDesc': 'Tu compañero inteligente de cocina que te ayuda a gestionar alimentos, reducir desperdicios y descubrir recetas increíbles.',
      'onboarding.pantryTitle': 'Seguimiento Inteligente de Despensa',
      'onboarding.pantryDesc': 'Agrega artículos manualmente o busca en nuestra base de datos. Mantén un registro de todo en tu cocina con facilidad.',
      'onboarding.aiTitle': 'Sugerencias de Recetas con IA',
      'onboarding.aiDesc': 'Obtén ideas de comidas personalizadas basadas en lo que tienes. Cocina comidas deliciosas sin compras adicionales.',
      'onboarding.wasteTitle': 'Nunca Desperdicies Comida',
      'onboarding.wasteDesc': 'Las alertas inteligentes de vencimiento te mantienen informado. Ahorra dinero y ayuda al planeta reduciendo el desperdicio de alimentos.',
      
      // Auth
      'auth.signIn': 'Iniciar sesión',
      'auth.signUp': 'Registrarse',
      'auth.signOut': 'Cerrar sesión',
      'auth.notLoggedIn': 'No has iniciado sesión',
      'auth.email': 'Correo electrónico',
      'auth.password': 'Contraseña',
      'auth.fillAllFields': 'Por favor completa todos los campos',
      'auth.invalidEmail': 'Dirección de correo electrónico inválida',
      'auth.passwordsDoNotMatch': 'Las contraseñas no coinciden',
      'auth.passwordTooShort': 'La contraseña debe tener al menos 6 caracteres',
      'auth.signInFailed': 'Error al iniciar sesión',
      'auth.signUpFailed': 'Error al registrarse',
      'auth.welcomeBack': '¡Bienvenido de nuevo!',
      'auth.verifyEmail': 'Verifica tu correo electrónico',
      'auth.verifyEmailMessage': 'Por favor revisa tu correo electrónico y haz clic en el enlace de verificación para completar tu registro.',
      'auth.accountCreated': '¡Cuenta creada exitosamente!',
      'auth.unexpectedError': 'Ocurrió un error inesperado',
      'auth.forgotPassword': '¿Olvidaste tu contraseña?',
      'auth.skipForNow': 'Saltar por ahora',
      
      // Subscription
      'subscription.title': 'Desbloquea Funciones Premium',
      'subscription.subtitle': 'Obtén acceso completo a todas las funciones con nuestra suscripción asequible',
      'subscription.month': 'mes',
      'subscription.freeTrial': '30 Días de Prueba Gratis',
      'subscription.whatYouGet': 'Lo Que Obtienes',
      'subscription.feature1Title': 'Gestión Inteligente de Despensa',
      'subscription.feature1Desc': 'Rastrea todos tus alimentos con alertas de vencimiento y categorización inteligente',
      'subscription.feature2Title': 'Sugerencias de Recetas con IA',
      'subscription.feature2Desc': 'Obtén ideas de comidas personalizadas basadas en los ingredientes que ya tienes',
      'subscription.feature3Title': 'Sincronización de Lista de Compras',
      'subscription.feature3Desc': 'Genera automáticamente listas de compras y sincroniza entre dispositivos',
      'subscription.feature4Title': 'Reduce el Desperdicio de Alimentos',
      'subscription.feature4Desc': 'Ahorra dinero y ayuda al medio ambiente con seguimiento inteligente de vencimientos',
      'subscription.trialInfo': 'Prueba gratis por 30 días, luego solo $1.99/mes. Cancela en cualquier momento.',
      'subscription.continue': 'Iniciar Prueba Gratis',
      'subscription.disclaimer': 'No se requiere pago durante el período de prueba',
      
      // Pantry
      'pantry.title': 'Mi Despensa',
      'pantry.addFirst': 'Agrega tu primer artículo',
      'pantry.search': 'Buscar en despensa...',
      'pantry.addItem': 'Agregar artículo',
      'pantry.foodSearch': 'Buscar alimentos',
      'pantry.itemName': 'Nombre del artículo',
      'pantry.category': 'Categoría',
      'pantry.quantity': 'Cantidad',
      'pantry.unit': 'Unidad',
      'pantry.expirationDate': 'Fecha de vencimiento',
      'pantry.notes': 'Notas',
      'pantry.addToPantry': 'Agregar a la despensa',
      'pantry.itemAdded': '¡Artículo agregado a la despensa!',
      'pantry.itemDeleted': 'Artículo eliminado',
      'pantry.deleteConfirm': '¿Estás seguro de que quieres eliminar este artículo?',
      'pantry.expiresIn': 'Vence en {{days}} días',
      'pantry.expired': 'Vencido',
      'pantry.fresh': 'Fresco',
      'pantry.emptyTitle': 'Tu despensa está vacía',
      'pantry.emptyDescription': 'Comienza agregando artículos para rastrear tu inventario de alimentos',
      'pantry.editItem': 'Editar artículo',
      'pantry.updateItem': 'Actualizar artículo',
      'pantry.itemUpdated': '¡Artículo actualizado exitosamente!',
      
      // Planner
      'planner.title': 'Planificador de comidas',
      'planner.myRecipes': 'Mis recetas',
      'planner.aiSuggestions': 'Sugerencias de IA',
      'planner.basedOnPantry': 'Basado en los artículos de tu despensa',
      'planner.noRecipes': 'Aún no hay recetas',
      'planner.addRecipeHint': 'Agrega recetas para comenzar a planificar comidas',
      'planner.ingredientsAvailable': '{{count}} ingredientes disponibles',
      'planner.loadingRecipes': 'Cargando sugerencias de recetas con IA...',
      'planner.pullToRefresh': 'Desliza hacia abajo para actualizar',
      'planner.dragToLoadAI': 'Arrastra hacia abajo para cargar sugerencias de IA',
      
      // Shopping
      'shopping.title': 'Lista de compras',
      'shopping.addNewItem': 'Agregar nuevo artículo',
      'shopping.itemsCompleted': '{{count}} artículos completados',
      'shopping.clearCompleted': 'Limpiar completados',
      'shopping.noShoppingItems': 'Tu lista de compras está vacía',
      'shopping.addItemsHint': 'Agrega artículos que necesites comprar',
      'shopping.item': 'artículo',
      'shopping.items': 'artículos',
      'shopping.toBuy': 'para comprar',
      'shopping.clear': 'Limpiar',
      'shopping.itemName': 'Nombre del artículo',
      'shopping.quantity': 'Cantidad',
      'shopping.addItem': 'Agregar artículo',
      'shopping.qty': 'Cant',
      'shopping.emptyTitle': 'La lista de compras está vacía',
      'shopping.emptyDescription': 'Agrega artículos que necesites comprar en la tienda',
      'shopping.toBuySection': 'Para comprar',
      'shopping.completedSection': 'Completados',
      'shopping.loadError': 'Error al cargar artículos de compras',
      'shopping.enterItemName': 'Por favor ingresa un nombre de artículo',
      'shopping.enterValidQuantity': 'Por favor ingresa una cantidad válida',
      'shopping.addItemError': 'Error al agregar artículo',
      'shopping.updateItemError': 'Error al actualizar artículo',
      'shopping.deleteItemError': 'Error al eliminar artículo',
      'shopping.clearCompletedConfirm': '¿Eliminar todos los artículos marcados de la lista?',
      'shopping.clearCompletedError': 'Error al limpiar artículos completados',
      
      // Profile
      'profile.title': 'Perfil',
      'profile.statistics': 'Estadísticas',
      'profile.totalItems': 'Artículos totales',
      'profile.expiringSoon': 'Próximos a vencer',
      'profile.expired': 'Vencidos',
      'profile.security': 'Seguridad',
      'profile.settings': 'Configuración',
      'profile.language': 'Idioma',
      'profile.languageDesc': 'Cambiar idioma de la aplicación',
      'profile.notifications': 'Notificaciones',
      'profile.notificationsDesc': 'Gestionar preferencias de notificaciones',
      'profile.about': 'Acerca de',
      'profile.aboutDesc': 'Información de la aplicación y soporte',
      'profile.tutorial': 'Tutorial',
      'profile.tutorialDesc': 'Ver el tutorial de la aplicación nuevamente',
      'profile.signOut': 'Cerrar sesión',
      'profile.signOutConfirm': '¿Estás seguro de que quieres cerrar sesión?',
      'profile.signedOut': 'Sesión cerrada exitosamente',
      'profile.signOutError': 'Error al cerrar sesión',
      'profile.pleaseSignIn': 'Por favor inicia sesión para usar esta función',
      'profile.twoFactor': 'Autenticación de dos factores',
      'profile.twoFactorDesc': 'Agregar una capa adicional de seguridad',
      'profile.twoFactorEnabled': 'Habilitado',
      'profile.twoFaDisabled': 'Autenticación de dos factores deshabilitada',
      'profile.twoFaDisableError': 'Error al deshabilitar autenticación de dos factores',
      'profile.disableTwoFa': 'Deshabilitar 2FA',
      'profile.disableTwoFaConfirm': '¿Estás seguro de que quieres deshabilitar la autenticación de dos factores?',
      'profile.disable': 'Deshabilitar',
      
      // Notifications
      'notifications.title': 'Configuración de notificaciones',
      'notifications.enabled': 'Habilitar notificaciones',
      'notifications.expirationAlerts': 'Alertas de vencimiento',
      'notifications.expirationAlertsDesc': 'Recibe notificaciones cuando los artículos estén por vencer',
      'notifications.daysBeforeExpiry': 'Días antes del vencimiento',
      'notifications.dailyReminder': 'Recordatorio diario',
      'notifications.dailyReminderDesc': 'Resumen diario de artículos que vencen',
      'notifications.shoppingListReminders': 'Recordatorios de lista de compras',
      'notifications.shoppingListRemindersDesc': 'Recordatorios para artículos de la lista de compras',
      'notifications.recipesSuggestions': 'Sugerencias de recetas',
      'notifications.recipesSuggestionsDesc': 'Recibe notificaciones sobre nuevas ideas de recetas',
      'notifications.permissionRequired': 'Permiso requerido',
      'notifications.permissionMessage': 'Por favor habilita las notificaciones en la configuración de tu dispositivo para recibir alertas.',
      'notifications.openSettings': 'Abrir configuración',
      
      // About
      'about.title': 'Acerca de Nutrion',
      'about.version': 'Versión',
      'about.description': 'Nutrion te ayuda a gestionar tu despensa, rastrear fechas de vencimiento de alimentos y planificar automáticamente comidas equilibradas basadas en lo que ya está disponible en casa.',
      'about.features': 'Características',
      'about.website': 'Sitio web',
      'about.privacy': 'Política de privacidad',
      'about.terms': 'Términos de servicio',
      'about.support': 'Soporte',
      'about.rateApp': 'Calificar aplicación',
      'about.madeWith': 'Hecho con ❤️ por el equipo de Nutrion',
      'about.copyright': '© 2025 Nutrion. Todos los derechos reservados.',
      
      // Food Search
      searchForFoods: 'Buscar alimentos',
      searchPlaceholder: 'Buscar artículos de comida...',
      searchHint: 'Escribe al menos 2 caracteres para buscar',
      resultsFor: '{{count}} resultados para "{{query}}"',
      noResults: 'No se encontraron resultados',
      tryDifferent: 'Intenta con un término de búsqueda diferente',
      
      // Categories
      dairy: 'Lácteos',
      meat: 'Carne',
      fruits: 'Frutas',
      vegetables: 'Verduras',
      grains: 'Granos',
      beverages: 'Bebidas',
      snacks: 'Bocadillos',
      condiments: 'Condimentos',
      frozen: 'Congelados',
      other: 'Otro',
      
      // Units
      pcs: 'pzs',
      kg: 'kg',
      g: 'g',
      lb: 'lb',
      oz: 'oz',
      l: 'L',
      ml: 'mL',
      cup: 'taza',
      tbsp: 'cdas',
      tsp: 'cdtas',
    },
  },
  zh: {
    translation: {
      cancel: '取消',
      save: '保存',
      delete: '删除',
      edit: '编辑',
      add: '添加',
      search: '搜索',
      loading: '加载中...',
      error: '错误',
      success: '成功',
      confirm: '确认',
      ok: '确定',
      next: '下一步',
      skip: '跳过',
      continue: '继续',
      getStarted: '开始',
      pantry: '食品储藏室',
      planner: '计划',
      shopping: '购物',
      profile: '个人资料',
      'onboarding.welcome': '欢迎使用Nutrion',
      'onboarding.welcomeDesc': '您的智能厨房助手，帮助您管理食物、减少浪费并发现美味食谱。',
      'onboarding.pantryTitle': '智能储藏室跟踪',
      'onboarding.pantryDesc': '手动添加项目或搜索我们的数据库。轻松跟踪厨房中的所有物品。',
      'onboarding.aiTitle': 'AI食谱建议',
      'onboarding.aiDesc': '根据您已有的食材获得个性化的餐食创意。无需额外购物即可烹饪美味佳肴。',
      'onboarding.wasteTitle': '永不浪费食物',
      'onboarding.wasteDesc': '智能过期提醒让您随时了解情况。通过减少食物浪费来节省金钱并帮助地球。',
      'pantry.title': '我的食品储藏室',
      'planner.title': '膳食计划',
      'planner.ingredientsAvailable': '{{count}}种食材可用',
      'shopping.title': '购物清单',
      'profile.title': '个人资料',
      'subscription.title': '解锁高级功能',
      'subscription.subtitle': '通过我们实惠的订阅获得所有功能的完全访问权限',
      'subscription.month': '月',
      'subscription.freeTrial': '30天免费试用',
      'subscription.whatYouGet': '您将获得',
      'subscription.feature1Title': '智能储藏室管理',
      'subscription.feature1Desc': '跟踪所有食品项目，包括过期提醒和智能分类',
      'subscription.feature2Title': 'AI食谱建议',
      'subscription.feature2Desc': '根据您已有的食材获得个性化的餐食创意',
      'subscription.feature3Title': '购物清单同步',
      'subscription.feature3Desc': '自动生成购物清单并跨设备同步',
      'subscription.feature4Title': '减少食物浪费',
      'subscription.feature4Desc': '通过智能过期跟踪节省金钱并帮助环境',
      'subscription.trialInfo': '免费试用30天，然后每月仅需$1.99。随时取消。',
      'subscription.continue': '开始免费试用',
      'subscription.disclaimer': '试用期间无需付款',
      searchForFoods: '搜索食物',
      searchPlaceholder: '搜索食品项目...',
      searchHint: '输入至少2个字符进行搜索',
      resultsFor: '"{{query}}"的{{count}}个结果',
      noResults: '未找到结果',
      tryDifferent: '尝试不同的搜索词',
    },
  },
  ja: {
    translation: {
      cancel: 'キャンセル',
      save: '保存',
      delete: '削除',
      edit: '編集',
      add: '追加',
      search: '検索',
      loading: '読み込み中...',
      error: 'エラー',
      success: '成功',
      confirm: '確認',
      ok: 'OK',
      next: '次へ',
      skip: 'スキップ',
      continue: '続ける',
      getStarted: '始める',
      pantry: 'パントリー',
      planner: 'プランナー',
      shopping: '買い物',
      profile: 'プロフィール',
      'onboarding.welcome': 'Nutrionへようこそ',
      'onboarding.welcomeDesc': '食品管理、廃棄削減、素晴らしいレシピの発見をサポートするスマートキッチンコンパニオン。',
      'onboarding.pantryTitle': 'スマートパントリー追跡',
      'onboarding.pantryDesc': '手動でアイテムを追加するか、データベースを検索します。キッチンのすべてを簡単に追跡できます。',
      'onboarding.aiTitle': 'AIレシピ提案',
      'onboarding.aiDesc': 'すでにある材料に基づいてパーソナライズされた食事のアイデアを取得。追加の買い物なしで美味しい料理を作れます。',
      'onboarding.wasteTitle': '食品を無駄にしない',
      'onboarding.wasteDesc': 'スマート賞味期限アラートで常に情報を把握。食品廃棄を削減してお金を節約し、地球を守ります。',
      'pantry.title': 'マイパントリー',
      'planner.title': '食事プランナー',
      'planner.ingredientsAvailable': '{{count}}種類の食材が利用可能',
      'shopping.title': '買い物リスト',
      'profile.title': 'プロフィール',
      'subscription.title': 'プレミアム機能をアンロック',
      'subscription.subtitle': '手頃な価格のサブスクリプションですべての機能にフルアクセス',
      'subscription.month': '月',
      'subscription.freeTrial': '30日間無料トライアル',
      'subscription.whatYouGet': '提供内容',
      'subscription.feature1Title': 'スマートパントリー管理',
      'subscription.feature1Desc': '賞味期限アラートとスマート分類ですべての食品を追跡',
      'subscription.feature2Title': 'AIレシピ提案',
      'subscription.feature2Desc': 'すでにある材料に基づいてパーソナライズされた食事のアイデアを取得',
      'subscription.feature3Title': '買い物リスト同期',
      'subscription.feature3Desc': '買い物リストを自動生成し、デバイス間で同期',
      'subscription.feature4Title': '食品廃棄を削減',
      'subscription.feature4Desc': 'スマート賞味期限追跡でお金を節約し、環境を守る',
      'subscription.trialInfo': '30日間無料でお試し、その後月額$1.99。いつでもキャンセル可能。',
      'subscription.continue': '無料トライアルを開始',
      'subscription.disclaimer': 'トライアル期間中は支払い不要',
      searchForFoods: '食品を検索',
      searchPlaceholder: '食品を検索...',
      searchHint: '検索するには少なくとも2文字入力してください',
      resultsFor: '"{{query}}"の{{count}}件の結果',
      noResults: '結果が見つかりません',
      tryDifferent: '別の検索語を試してください',
    },
  },
  de: {
    translation: {
      cancel: 'Abbrechen',
      save: 'Speichern',
      delete: 'Löschen',
      edit: 'Bearbeiten',
      add: 'Hinzufügen',
      search: 'Suchen',
      loading: 'Lädt...',
      error: 'Fehler',
      success: 'Erfolg',
      confirm: 'Bestätigen',
      ok: 'OK',
      next: 'Weiter',
      skip: 'Überspringen',
      continue: 'Fortfahren',
      getStarted: 'Loslegen',
      pantry: 'Vorratskammer',
      planner: 'Planer',
      shopping: 'Einkaufen',
      profile: 'Profil',
      'onboarding.welcome': 'Willkommen bei Nutrion',
      'onboarding.welcomeDesc': 'Ihr intelligenter Küchenbegleiter, der Ihnen hilft, Lebensmittel zu verwalten, Verschwendung zu reduzieren und erstaunliche Rezepte zu entdecken.',
      'onboarding.pantryTitle': 'Intelligente Vorratsverfolgung',
      'onboarding.pantryDesc': 'Fügen Sie Artikel manuell hinzu oder durchsuchen Sie unsere Datenbank. Behalten Sie alles in Ihrer Küche im Auge.',
      'onboarding.aiTitle': 'KI-Rezeptvorschläge',
      'onboarding.aiDesc': 'Erhalten Sie personalisierte Essensideen basierend auf dem, was Sie haben. Kochen Sie köstliche Mahlzeiten ohne zusätzlichen Einkauf.',
      'onboarding.wasteTitle': 'Verschwenden Sie nie Lebensmittel',
      'onboarding.wasteDesc': 'Intelligente Ablaufwarnungen halten Sie auf dem Laufenden. Sparen Sie Geld und helfen Sie dem Planeten, indem Sie Lebensmittelverschwendung reduzieren.',
      'pantry.title': 'Meine Vorratskammer',
      'planner.title': 'Essensplaner',
      'planner.ingredientsAvailable': '{{count}} Zutaten verfügbar',
      'shopping.title': 'Einkaufsliste',
      'profile.title': 'Profil',
      'subscription.title': 'Premium-Funktionen freischalten',
      'subscription.subtitle': 'Erhalten Sie vollen Zugriff auf alle Funktionen mit unserem erschwinglichen Abonnement',
      'subscription.month': 'Monat',
      'subscription.freeTrial': '30 Tage kostenlose Testversion',
      'subscription.whatYouGet': 'Was Sie erhalten',
      'subscription.feature1Title': 'Intelligente Vorratsverwaltung',
      'subscription.feature1Desc': 'Verfolgen Sie alle Ihre Lebensmittel mit Ablaufwarnungen und intelligenter Kategorisierung',
      'subscription.feature2Title': 'KI-Rezeptvorschläge',
      'subscription.feature2Desc': 'Erhalten Sie personalisierte Essensideen basierend auf Zutaten, die Sie bereits haben',
      'subscription.feature3Title': 'Einkaufslisten-Synchronisation',
      'subscription.feature3Desc': 'Generieren Sie automatisch Einkaufslisten und synchronisieren Sie über Geräte hinweg',
      'subscription.feature4Title': 'Lebensmittelverschwendung reduzieren',
      'subscription.feature4Desc': 'Sparen Sie Geld und helfen Sie der Umwelt mit intelligenter Ablaufverfolgung',
      'subscription.trialInfo': '30 Tage kostenlos testen, dann nur $1.99/Monat. Jederzeit kündbar.',
      'subscription.continue': 'Kostenlose Testversion starten',
      'subscription.disclaimer': 'Keine Zahlung während der Testphase erforderlich',
      searchForFoods: 'Lebensmittel suchen',
      searchPlaceholder: 'Lebensmittel suchen...',
      searchHint: 'Geben Sie mindestens 2 Zeichen ein, um zu suchen',
      resultsFor: '{{count}} Ergebnisse für "{{query}}"',
      noResults: 'Keine Ergebnisse gefunden',
      tryDifferent: 'Versuchen Sie einen anderen Suchbegriff',
    },
  },
  nl: {
    translation: {
      cancel: 'Annuleren',
      save: 'Opslaan',
      delete: 'Verwijderen',
      edit: 'Bewerken',
      add: 'Toevoegen',
      search: 'Zoeken',
      loading: 'Laden...',
      error: 'Fout',
      success: 'Succes',
      confirm: 'Bevestigen',
      ok: 'OK',
      next: 'Volgende',
      skip: 'Overslaan',
      continue: 'Doorgaan',
      getStarted: 'Aan de slag',
      pantry: 'Voorraadkast',
      planner: 'Planner',
      shopping: 'Boodschappen',
      profile: 'Profiel',
      'onboarding.welcome': 'Welkom bij Nutrion',
      'onboarding.welcomeDesc': 'Uw slimme keukenassistent die u helpt voedsel te beheren, verspilling te verminderen en geweldige recepten te ontdekken.',
      'onboarding.pantryTitle': 'Slim voorraadbeheer',
      'onboarding.pantryDesc': 'Voeg items handmatig toe of doorzoek onze database. Houd alles in uw keuken gemakkelijk bij.',
      'onboarding.aiTitle': 'AI-receptsuggesties',
      'onboarding.aiDesc': 'Krijg gepersonaliseerde maaltijdideeën op basis van wat u heeft. Kook heerlijke maaltijden zonder extra boodschappen.',
      'onboarding.wasteTitle': 'Verspil nooit voedsel',
      'onboarding.wasteDesc': 'Slimme vervaldatumwaarschuwingen houden u op de hoogte. Bespaar geld en help de planeet door voedselverspilling te verminderen.',
      'pantry.title': 'Mijn Voorraadkast',
      'planner.title': 'Maaltijdplanner',
      'planner.ingredientsAvailable': '{{count}} ingrediënten beschikbaar',
      'shopping.title': 'Boodschappenlijst',
      'profile.title': 'Profiel',
      'subscription.title': 'Premium-functies ontgrendelen',
      'subscription.subtitle': 'Krijg volledige toegang tot alle functies met ons betaalbare abonnement',
      'subscription.month': 'maand',
      'subscription.freeTrial': '30 dagen gratis proefperiode',
      'subscription.whatYouGet': 'Wat je krijgt',
      'subscription.feature1Title': 'Slim voorraadbeheer',
      'subscription.feature1Desc': 'Volg al je voedsel met vervaldatumwaarschuwingen en slimme categorisering',
      'subscription.feature2Title': 'AI-receptsuggesties',
      'subscription.feature2Desc': 'Krijg gepersonaliseerde maaltijdideeën op basis van ingrediënten die je al hebt',
      'subscription.feature3Title': 'Boodschappenlijst synchronisatie',
      'subscription.feature3Desc': 'Genereer automatisch boodschappenlijsten en synchroniseer tussen apparaten',
      'subscription.feature4Title': 'Verminder voedselverspilling',
      'subscription.feature4Desc': 'Bespaar geld en help het milieu met slimme vervaldatumtracking',
      'subscription.trialInfo': 'Probeer 30 dagen gratis, daarna slechts $1.99/maand. Altijd opzegbaar.',
      'subscription.continue': 'Start gratis proefperiode',
      'subscription.disclaimer': 'Geen betaling vereist tijdens proefperiode',
      searchForFoods: 'Voedsel zoeken',
      searchPlaceholder: 'Zoek naar voedsel...',
      searchHint: 'Typ minimaal 2 tekens om te zoeken',
      resultsFor: '{{count}} resultaten voor "{{query}}"',
      noResults: 'Geen resultaten gevonden',
      tryDifferent: 'Probeer een andere zoekterm',
    },
  },
  fr: {
    translation: {
      cancel: 'Annuler',
      save: 'Enregistrer',
      delete: 'Supprimer',
      edit: 'Modifier',
      add: 'Ajouter',
      search: 'Rechercher',
      loading: 'Chargement...',
      error: 'Erreur',
      success: 'Succès',
      confirm: 'Confirmer',
      ok: 'OK',
      next: 'Suivant',
      skip: 'Passer',
      continue: 'Continuer',
      getStarted: 'Commencer',
      pantry: 'Garde-manger',
      planner: 'Planificateur',
      shopping: 'Courses',
      profile: 'Profil',
      'onboarding.welcome': 'Bienvenue sur Nutrion',
      'onboarding.welcomeDesc': 'Votre compagnon de cuisine intelligent qui vous aide à gérer les aliments, réduire le gaspillage et découvrir des recettes incroyables.',
      'onboarding.pantryTitle': 'Suivi intelligent du garde-manger',
      'onboarding.pantryDesc': 'Ajoutez des articles manuellement ou recherchez dans notre base de données. Gardez une trace de tout dans votre cuisine facilement.',
      'onboarding.aiTitle': 'Suggestions de recettes IA',
      'onboarding.aiDesc': 'Obtenez des idées de repas personnalisées basées sur ce que vous avez. Cuisinez de délicieux repas sans courses supplémentaires.',
      'onboarding.wasteTitle': 'Ne gaspillez jamais de nourriture',
      'onboarding.wasteDesc': 'Les alertes d\'expiration intelligentes vous tiennent informé. Économisez de l\'argent et aidez la planète en réduisant le gaspillage alimentaire.',
      'pantry.title': 'Mon Garde-manger',
      'planner.title': 'Planificateur de repas',
      'planner.ingredientsAvailable': '{{count}} ingrédients disponibles',
      'shopping.title': 'Liste de courses',
      'profile.title': 'Profil',
      'subscription.title': 'Débloquer les fonctionnalités premium',
      'subscription.subtitle': 'Obtenez un accès complet à toutes les fonctionnalités avec notre abonnement abordable',
      'subscription.month': 'mois',
      'subscription.freeTrial': '30 jours d\'essai gratuit',
      'subscription.whatYouGet': 'Ce que vous obtenez',
      'subscription.feature1Title': 'Gestion intelligente du garde-manger',
      'subscription.feature1Desc': 'Suivez tous vos aliments avec des alertes d\'expiration et une catégorisation intelligente',
      'subscription.feature2Title': 'Suggestions de recettes IA',
      'subscription.feature2Desc': 'Obtenez des idées de repas personnalisées basées sur les ingrédients que vous avez déjà',
      'subscription.feature3Title': 'Synchronisation de liste de courses',
      'subscription.feature3Desc': 'Générez automatiquement des listes de courses et synchronisez entre les appareils',
      'subscription.feature4Title': 'Réduire le gaspillage alimentaire',
      'subscription.feature4Desc': 'Économisez de l\'argent et aidez l\'environnement avec un suivi intelligent des expirations',
      'subscription.trialInfo': 'Essayez gratuitement pendant 30 jours, puis seulement $1.99/mois. Annulez à tout moment.',
      'subscription.continue': 'Commencer l\'essai gratuit',
      'subscription.disclaimer': 'Aucun paiement requis pendant la période d\'essai',
      searchForFoods: 'Rechercher des aliments',
      searchPlaceholder: 'Rechercher des aliments...',
      searchHint: 'Tapez au moins 2 caractères pour rechercher',
      resultsFor: '{{count}} résultats pour "{{query}}"',
      noResults: 'Aucun résultat trouvé',
      tryDifferent: 'Essayez un terme de recherche différent',
    },
  },
};

// Get saved language or use device locale
const getInitialLanguage = async (): Promise<string> => {
  try {
    const savedLanguage = await AsyncStorage.getItem(LANGUAGE_KEY);
    if (savedLanguage) {
      console.log('Loaded saved language:', savedLanguage);
      return savedLanguage;
    }
    
    // Get device locale
    const deviceLocale = Localization.getLocales()[0];
    const languageCode = deviceLocale.languageCode || 'en';
    console.log('Using device language:', languageCode);
    
    // Map language codes to supported languages
    if (resources[languageCode as keyof typeof resources]) {
      return languageCode;
    }
    
    return 'en';
  } catch (error) {
    console.error('Error getting initial language:', error);
    return 'en';
  }
};

// Initialize i18n
const initI18n = async () => {
  const initialLanguage = await getInitialLanguage();
  
  await i18n
    .use(initReactI18next)
    .init({
      resources,
      lng: initialLanguage,
      fallbackLng: 'en',
      interpolation: {
        escapeValue: false,
      },
      compatibilityJSON: 'v3',
      react: {
        useSuspense: false,
      },
    });
  
  console.log('i18n initialized with language:', initialLanguage);
};

initI18n();

// Save language preference and trigger app-wide update
export const changeLanguage = async (languageCode: string) => {
  try {
    console.log('Changing language to:', languageCode);
    await AsyncStorage.setItem(LANGUAGE_KEY, languageCode);
    await i18n.changeLanguage(languageCode);
    console.log('Language changed successfully to:', languageCode);
    return true;
  } catch (error) {
    console.error('Error changing language:', error);
    return false;
  }
};

// Get current language
export const getCurrentLanguage = (): string => {
  return i18n.language || 'en';
};

// Get available languages
export const getAvailableLanguages = () => {
  return [
    { code: 'en', name: 'English', nativeName: 'English' },
    { code: 'es', name: 'Spanish', nativeName: 'Español' },
    { code: 'zh', name: 'Chinese', nativeName: '中文' },
    { code: 'ja', name: 'Japanese', nativeName: '日本語' },
    { code: 'de', name: 'German', nativeName: 'Deutsch' },
    { code: 'nl', name: 'Dutch', nativeName: 'Nederlands' },
    { code: 'fr', name: 'French', nativeName: 'Français' },
  ];
};

export default i18n;
